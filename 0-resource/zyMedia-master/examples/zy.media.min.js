"use strict";!function(){function e(e,t){return parseInt(getComputedStyle(e,null).getPropertyValue(t))}function t(e,t){e.classList.add(t)}function i(e,t){e.classList.remove(t)}function n(e,t){(!isFinite(e)||e<0)&&(e=0);var i=t.alwaysShowHours?[0]:[];return Math.floor(e/3600)%24&&i.push(Math.floor(e/3600)%24),i.push(Math.floor(e/60)%60),i.push(Math.floor(e%60)),i=i.join(":"),1==t.timeFormatType&&(i=i.replace(/(:|^)([0-9])(?=:|$)/g,"$10$2")),i}function a(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen}function o(e){e=e.toLowerCase().split("?")[0];var t=e.substring(e.lastIndexOf(".")+1),i=/mp4|m4v|ogg|ogv|m3u8|webm|webmv|wmv|mpeg|mov/gi.test(t)?"video/":"audio/";switch(t){case"mp4":case"m4v":case"m4a":return i+"mp4";case"webm":case"webma":case"webmv":return i+"webm";case"ogg":case"oga":case"ogv":return i+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return i+"mp2t";default:return i+t}}function s(e,t){return e&&!t?o(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t}function l(e,t,i){var n,a,o,l=[];if(t.type)if("string"==typeof t.type)l.push({type:t.type,url:i});else for(n=0;n<t.type.length;n++)l.push({type:t.type[n],url:i});else if(null!==i)l.push({type:s(i,e.getAttribute("type")),url:i});else for(n=0;n<e.children.length;n++)a=e.children[n],1==a.nodeType&&"source"==a.tagName.toLowerCase()&&(i=a.getAttribute("src"),l.push({type:s(i,a.getAttribute("type")),url:i}));if(r.features.isBustedAndroid&&(e.canPlayType=function(e){return/video\/(mp4|m4v)/i.test(e)?"maybe":""}),r.features.isChromium&&(e.canPlayType=function(e){return/video\/(webm|ogv|ogg)/i.test(e)?"maybe":""}),r.features.supportsCanPlayType)for(n=0;n<l.length;n++)if("video/m3u8"==l[n].type||""!==e.canPlayType(l[n].type).replace(/no/,"")||""!==e.canPlayType(l[n].type.replace(/mp3/,"mpeg")).replace(/no/,"")||""!==e.canPlayType(l[n].type.replace(/m4a/,"mp4")).replace(/no/,"")){o=!0;break}return o}var r={};r.config={type:"",mediaTitle:"",nativeControls:!1,autoplay:!1,preload:"none",videoWidth:"100%",videoHeight:"auto",aspectRation:16/9,audioWidth:"100%",audioHeight:44,autoLoop:!1,timeFormatType:1,alwaysShowHours:!1,alwaysShowControls:!1,hideVideoControlsOnLoad:!1,enableFullscreen:!0,pauseOtherPlayers:!0,enableVisibilityState:!0,duration:0,success:null,error:null,beforePlay:null},function(e){var t=window.navigator.userAgent.toLowerCase(),i=document.createElement("video");e.isBustedAndroid=/android 2\.[12]/i.test(t),e.isChromium=/chromium/i.test(t),e.hasTouch="ontouchstart"in window,e.supportsCanPlayType=void 0!==i.canPlayType,e.isPlaysInline=matchMedia("(-webkit-video-playable-inline)").matches,e.iPhoneVersion=t.match(/iPhone OS (\d+)_?/i),e.isVendorBigPlay=function(){return window.MSStream,!1}(),e.isVendorControls=/baidu/i.test(t)&&!/baiduboxapp/i.test(t),e.nativeFullscreenPrefix=function(){return i.requestFullScreen?"":i.webkitRequestFullScreen?"webkit":i.mozRequestFullScreen?"moz":i.msRequestFullScreen?"ms":"-"}(),void 0!==document.visibilityState?(e.vChange="visibilitychange",e.vState="visibilityState"):void 0!==document.webkitVisibilityState?(e.vChange="webkitvisibilitychange",e.vState="webkitVisibilityState"):(e.vChange="",e.vState=""),e.hasOldNativeFullScreen="-"==e.nativeFullscreenPrefix&&i.webkitEnterFullscreen,e.hasOldNativeFullScreen&&/mac os x 10_5/i.test(t)&&(e.nativeFullscreenPrefix="-",e.hasOldNativeFullScreen=!1)}(r.features={});var d=0;r.players={},r.MediaPlayer=function(e,t){var i,n=this;if(!e.isInstantiated){e.isInstantiated=!0,n.media=e;var a=n.media.tagName.toLowerCase();if(/audio|video/.test(a)){n.isVideo="video"===a,n.options={};for(i in r.config)n.options[i]=r.config[i];try{for(i in t)n.options[i]=t[i];var o=JSON.parse(n.media.getAttribute("data-config"));for(i in o)n.options[i]=o[i]}catch(e){}if("none"==n.options.preload&&r.features.iPhoneVersion&&r.features.iPhoneVersion[1]>=11&&(n.options.preload="auto"),n.isVideo||(n.options.alwaysShowControls=!0),n.options.nativeControls||r.features.isVendorControls)n.media.setAttribute("controls","controls"),r.features.isPlaysInline&&n.media.setAttribute("playsinline",""),n.media.style.position="relative";else{var s=n.media.getAttribute("src");s=""===s?null:s,l(n.media,n.options,s)?(n.id="zym_"+d++,r.players[n.id]=n,n.init()):alert("不支持此"+(n.isVideo?"视":"音")+"频")}}}},r.MediaPlayer.prototype={isControlsVisible:!0,isFullScreen:!1,setPlayerSize:function(t,i){var n=this;if(!a()&&!n.isFullScreen){if(void 0!=t&&"100%"!=t||(n.width=e(n.container,"width")),void 0==i||"auto"==i){var o=n.media.videoWidth,s=n.media.videoHeight;o&&s&&Math.abs(n.options.aspectRation-o/s)<.1&&(n.options.aspectRation=o/s),n.height=parseInt(n.width/n.options.aspectRation)}n.media.style.width=n.width+"px",n.media.style.height=n.container.style.height=n.height+"px"}},showControls:function(){var e=this;e.isControlsVisible||(e.controls.style.bottom=0,e.options.mediaTitle&&(e.title.style.top=0),e.isControlsVisible=!0)},hideControls:function(){var e=this;e.isControlsVisible&&!e.options.alwaysShowControls&&(e.controls.style.bottom="-45px",e.playbackRateOpts.style.display="none",e.options.mediaTitle&&(e.title.style.top="-35px"),e.isControlsVisible=!1)},setControlsTimer:function(e){var t=this;t.options.alwaysShowControls||(clearTimeout(t.controlsTimer),t.controlsTimer=setTimeout(function(){t.hideControls()},e))},updateTimeline:function(t){var i=this,n=void 0!==t?t.target:i.media,a=null,o=e(i.slider,"width");if(n.buffered&&n.buffered.length>0&&n.buffered.end&&n.duration?a=n.buffered.end(n.buffered.length-1)/n.duration:void 0!==n.bytesTotal&&n.bytesTotal>0&&void 0!==n.bufferedBytes?a=n.bufferedBytes/n.bytesTotal:t&&t.lengthComputable&&0!==t.total&&(a=t.loaded/t.total),null!==a&&(a=Math.min(1,Math.max(0,a)),i.loaded.style.width=o*a+"px",i.media.paused&&setTimeout(function(){i.loaded.style.width=o*a+"px",i.updateTimeline()},300)),void 0!==i.media.currentTime&&i.media.duration){var s=Math.round(o*i.media.currentTime/i.media.duration);i.current.style.width=s+"px",i.handle.style.left=s-Math.round(e(i.handle,"width")/2)+"px"}},updateTime:function(){var e=this;e.currentTime.innerHTML=n(e.media.currentTime,e.options),(e.options.duration>1||e.media.duration>1)&&(e.durationDuration.innerHTML=n(e.options.duration>1?e.options.duration:e.media.duration,e.options))},enterFullScreen:function(){var e=this;if("-"!=r.features.nativeFullscreenPrefix)e.container[r.features.nativeFullscreenPrefix+"RequestFullScreen"]();else if(r.features.hasOldNativeFullScreen)return void e.media.webkitEnterFullscreen();t(document.documentElement,"zy_fullscreen"),e.media.style.width=e.container.style.width="100%",e.media.style.height=e.container.style.height="100%",e.container.style.zIndex="1001",t(e.fullscreenBtn,"zy_unfullscreen"),e.isFullScreen=!0},exitFullScreen:function(){var e=this;(a()||e.isFullScreen)&&("-"!=r.features.nativeFullscreenPrefix?document[r.features.nativeFullscreenPrefix+"CancelFullScreen"]():r.features.hasOldNativeFullScreen&&document.webkitExitFullscreen()),i(document.documentElement,"zy_fullscreen"),e.media.style.width=e.width+"px",e.container.style.width="",e.media.style.height=e.container.style.height=e.height+"px",e.container.style.zIndex="",i(e.fullscreenBtn,"zy_unfullscreen"),e.isFullScreen=!1},buildContainer:function(){var t=this;t.container=t.media.parentNode,t.container.style.overflow="hidden",t.container.style.height=(t.isVideo?e(t.container,"width")/t.options.aspectRation:t.options.audioHeight)+"px",t.container.innerHTML='<div class="zy_wrap"></div><div class="zy_controls"></div>'+(t.options.mediaTitle?'<div class="zy_title">'+t.options.mediaTitle+"</div>":""),t.title=t.container.querySelector(".zy_title"),t.media.setAttribute("preload",t.options.preload),r.features.isPlaysInline&&t.media.setAttribute("playsinline",""),t.container.querySelector(".zy_wrap").appendChild(t.media),t.controls=t.container.querySelector(".zy_controls"),t.isVideo&&(t.width=t.options.videoWidth,t.height=t.options.videoHeight,"100%"==t.width&&"auto"==t.height&&(t.enableAutoSize=!0),t.setPlayerSize(t.width,t.height))},buildPlaypause:function(){function e(e){(t.media.isUserClick||t.options.autoplay)&&(i.className="play"===e?"zy_playpause_btn_pause":"zy_playpause_btn_play")}var t=this,i=document.createElement("div");i.className="zy_playpause_btn_play",t.controls.appendChild(i),i.addEventListener("click",function(){if(t.media.isUserClick=!0,t.media.paused){if("function"==typeof t.options.beforePlay&&t.options.beforePlay(t.media))return;if(t.media.isError){var e=t.media.currentTime;t.media.load(),t.media.isError=!1,t.media.currentTime=e}t.media.play(),t.media.paused||t.setControlsTimer(5e3)}else t.media.pause()}),t.media.addEventListener("play",function(){e("play")}),t.media.addEventListener("playing",function(){e("play")}),t.media.addEventListener("pause",function(){e("pse")}),t.media.addEventListener("paused",function(){e("pse")})},buildTimeline:function(){var t=this,i=document.createElement("div");i.className="zy_timeline",i.innerHTML='<div class="zy_timeline_slider"><div class="zy_timeline_buffering" style="display:none"></div><div class="zy_timeline_loaded"></div><div class="zy_timeline_current"></div><div class="zy_timeline_handle"></div></div>',t.controls.appendChild(i),t.slider=i.children[0],t.buffering=t.slider.children[0],t.loaded=t.slider.children[1],t.current=t.slider.children[2],t.handle=t.slider.children[3];var a=!1,o=t.slider.getBoundingClientRect().left,s=e(t.slider,"width"),l=e(t.handle,"width")/2,d=function(e){e.preventDefault(),e.stopPropagation();var i,r=0;i=e.changedTouches?e.changedTouches[0].pageX:e.pageX,t.media.duration&&(i<o?i=o:i>s+o&&(i=s+o),t.handle.style.left=i-l-o+"px",r=(i-o)/s*t.media.duration,t.currentTime.innerHTML=n(t.media.currentTime,t.options),a&&r!==t.media.currentTime&&(t.media.currentTime=r)),clearTimeout(t.controlsTimer)};r.features.hasTouch?i.addEventListener("touchstart",function(n){a=!0,t.media.pause(),d(n),o=t.slider.getBoundingClientRect().left,s=e(t.slider,"width"),i.addEventListener("touchmove",d),i.addEventListener("touchend",function(e){d(e),a=!1,t.media.play(),t.media.isUserClick=!0,t.setControlsTimer(5e3),i.removeEventListener("touchmove",d)})}):i.addEventListener("mousedown",function(n){a=!0,t.media.pause(),d(n),o=t.slider.getBoundingClientRect().left,s=e(t.slider,"width"),i.addEventListener("mousemove",d),i.addEventListener("mouseup",function(e){d(e),a=!1,t.media.play(),t.media.isUserClick=!0,t.slider.addEventListener("mousemove",d)})}),t.media.addEventListener("timeupdate",function(e){t.updateTimeline(e)})},buildCurrentTime:function(){var e=this,t=document.createElement("div");t.className="zy_currenttime",t.innerHTML=n(0,e.options),e.controls.appendChild(t),e.currentTime=t,e.media.addEventListener("timeupdate",function(){e.updateTime()})},buildTotalTime:function(){var e=this,t=document.createElement("div");t.className="zy_time",t.innerHTML=n(e.options.duration,e.options),e.controls.appendChild(t),e.durationDuration=t},buildFullscreen:function(){var e=this;if("-"!=r.features.nativeFullscreenPrefix){var t=function(t){e.isFullScreen&&(a()||e.exitFullScreen())};document.addEventListener(r.features.nativeFullscreenPrefix+"fullscreenchange",t)}e.fullscreenBtn=document.createElement("div"),e.fullscreenBtn.className="zy_fullscreen_btn",e.controls.appendChild(e.fullscreenBtn),e.fullscreenBtn.addEventListener("click",function(){"-"!=r.features.nativeFullscreenPrefix&&a()||e.isFullScreen?e.exitFullScreen():e.enterFullScreen()})},buildPlaybackRate:function(){var e=this;e.playbackRateBtn=document.createElement("div"),e.playbackRateBtn.className="zy_playback_rate",e.playbackRateBtn.innerHTML='<ul class="zy_playback_rate_option"><li>2</li><li>1.5</li><li class="active">1</li><li>0.75</li><li>0.5</li></ul><div class="zy_playback_rate_val">X1</div>',e.controls.appendChild(e.playbackRateBtn),e.playbackRateOpts=document.querySelector(".zy_playback_rate_option"),e.playbackRateVal=document.querySelector(".zy_playback_rate_val"),e.playbackRateBtn.addEventListener("click",function(){"block"!==e.playbackRateOpts.style.display?e.playbackRateOpts.style.display="block":e.playbackRateOpts.style.display="none"}),e.playbackRateOpts.addEventListener("click",function(t){var i=t.target;"LI"===i.nodeName&&"active"!==i.className&&(e.playbackRateVal.textContent="X"+i.textContent,e.playbackRateOpts.querySelector(".active").className="",i.className="active",e.media.playbackRate=i.textContent)})},buildDec:function(){var e=this,t=document.createElement("div");t.className="dec_loading",t.style.display="none",e.container.appendChild(t);var i=document.createElement("div");i.className="dec_error",i.style.display="none",i.innerHTML="播放失败，请重试",e.container.appendChild(i);var n=document.createElement("div");r.features.isVendorBigPlay||(n.className="dec_play",e.container.appendChild(n),n.addEventListener("click",function(){if(e.media.isUserClick=!0,"function"!=typeof e.options.beforePlay||!e.options.beforePlay(e.media)){if(e.media.isError){var t=e.media.currentTime;e.media.load(),e.media.isError=!1,e.media.currentTime=t}e.media.play(),e.media.paused||e.setControlsTimer(5e3)}})),e.media.addEventListener("play",function(){e.media.isUserClick&&(n.style.display="none",t.style.display="",e.buffering.style.display="none")}),e.media.addEventListener("playing",function(){n.style.display="none",t.style.display="none",e.buffering.style.display="none",i.style.display="none",clearTimeout(e.media._st)}),e.media.addEventListener("seeking",function(){t.style.display="",n.style.display="none",e.buffering.style.display="",clearTimeout(e.media._st)}),e.media.addEventListener("seeked",function(){t.style.display="none",e.buffering.style.display="none"}),e.media.addEventListener("pause",function(){n.style.display="",t.style.display="none",e.buffering.style.display="none",clearTimeout(e.media._st)}),e.media.addEventListener("waiting",function(){t.style.display="",n.style.display="none",i.style.display="none",e.buffering.style.display="",e.media._st=setTimeout(function(){var t=document.createEvent("Event");t.initEvent("error",!0,!0),e.media.dispatchEvent(t)},3e4)}),e.media.addEventListener("error",function(a){t.style.display="none",n.style.display="",e.buffering.style.display="none",e.media.pause(),i.style.display="",e.media.isError=!0,"function"==typeof e.options.error&&e.options.error(a)})},init:function(){var e=this,t=["Container","Playpause","CurrentTime","Timeline","TotalTime"];e.options.enableFullscreen&&e.isVideo&&t.push("Fullscreen"),e.isVideo&&t.push("Dec"),e.isVideo&&t.push("PlaybackRate");for(var i=0;i<t.length;i++)try{e["build"+t[i]]()}catch(e){}e.isVideo&&(r.features.hasTouch?e.media.addEventListener("touchend",function(){e.isControlsVisible?e.hideControls():(e.showControls(),e.media.paused||e.setControlsTimer(5e3))}):(e.media.addEventListener("click",function(){e.media.paused?e.media.play():e.media.pause()}),e.container.addEventListener("mouseenter",function(){e.showControls(),e.setControlsTimer(5e3)}),e.container.addEventListener("mousemove",function(){e.showControls(),e.setControlsTimer(5e3)})),e.options.hideVideoControlsOnLoad&&e.hideControls(),e.media.addEventListener("loadedmetadata",function(t){e.enableAutoSize&&setTimeout(function(){isNaN(e.media.videoHeight)||e.setPlayerSize()},50)})),e.media.addEventListener("play",function(){var t;for(var i in r.players)if(t=r.players[i],t.id!=e.id&&e.options.pauseOtherPlayers&&!t.paused&&!t.ended)try{t.media.pause()}catch(e){}}),e.options.enableVisibilityState&&r.features.vChange&&(document.addEventListener(r.features.vChange,function(){"hidden"==document[r.features.vState]&&setTimeout(function(){[].forEach.call(document.querySelectorAll("video, audio"),function(e){e.pause()})},100)}),r.features.vChange=""),window.addEventListener("orientationchange",function(){e.isVideo&&setTimeout(function(){e.setPlayerSize()},500)}),e.media.addEventListener("ended",function(t){e.media.currentTime=0,e.options.autoLoop?e.media.play():(e.isVideo&&setTimeout(function(){e.container.querySelector(".dec_loading").style.display="none",e.container.querySelector(".dec_play").style.display=""},20),e.media.pause()),e.updateTimeline(t)}),e.media.addEventListener("loadedmetadata",function(t){e.updateTime()}),e.options.autoplay&&(e.media.isUserClick=!1,e.media.play()),"function"==typeof e.options.success&&e.options.success(e.media)}},window.zymedia=function(e,t){"string"==typeof e?[].forEach.call(document.querySelectorAll(e),function(e){new r.MediaPlayer(e,t)}):new r.MediaPlayer(e,t)}}();